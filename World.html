<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8>
    <title>Three.js app</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { width: 100%; height: 100% }
    </style>
</head>

<body onload="loader()">
<script src="js/three.js"></script>
<script src="js/TrackballControls.js"></script>
<script src="js/MTLLoader.js"></script>
<script src="js/OBJLoader.js"></script>

<script>
    // Globális változók
    var WIDTH = window.innerWidth, HEIGHT = window.innerHeight;
    var aspectRatio = WIDTH / HEIGHT;
    var scene, camera;
    var roomUpperSidesMesh;
    var roomLowerSidesMesh;
    var renderer;
    var controls;


    function loader() {
        var OBJFile = 'assets/models/scene.obj';
        var MTLFile = 'assets/models/scene.mtl';
        new THREE.MTLLoader()
            .load(MTLFile, function (materials) {
                materials.preload();
                new THREE.OBJLoader()
                    .setMaterials(materials)
                    .load(OBJFile, function (object) {
                        meshLoaded = object;
                        console.log(object);

                        object.traverse(function (child) {
                            if (child instanceof THREE.Mesh) {
                                //child.rotation.z = -0.2;
                                child.scale.set(5, 5, 5);
                                //child.position.set(-20,-44.7,-30);
                                child.rotation.y += 1;
                            }
                        });
                        init();
                    });
            });
    }

    function init() {
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setSize( WIDTH, HEIGHT );
        renderer.setClearColor( 0x1b1e23, 1 );
        document.body.appendChild( renderer.domElement );

        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera( 75, aspectRatio, 0.1, 1000 );
        camera.position.z = 60;
        camera.position.x = -90;
        camera.position.y = 55;
        camera.lookAt( scene.position );

        var axesHelper = new THREE.AxesHelper( 10 );
        scene.add( axesHelper );

        // Kameramozgatás
        controls = new THREE.TrackballControls( camera, renderer.domElement );
        controls.rotateSpeed = 5.0;
        controls.panSpeed = 1.0;

        window.addEventListener( 'resize', handleWindowResize, false );
        //window.addEventListener( 'contextmenu', showRoomSides, false );
        window.addEventListener( 'dblclick', showRoomSides, false );

        var materialFloor = new THREE.MeshBasicMaterial( { color: 0x999999, side: THREE.DoubleSide } );
        var materialWalls = new THREE.MeshBasicMaterial( { color: 0x2c3227, side: THREE.DoubleSide } );
        var materialTransparent =  new THREE.MeshBasicMaterial( { transparent: true, opacity: 0, wireframe: true, side: THREE.DoubleSide} );

        var roomLowerSidesGeometry = new THREE.BoxBufferGeometry( 100, 100, 100);
        var roomLowerSides = [ materialWalls, materialTransparent, materialTransparent,materialFloor,materialTransparent,materialWalls];
        roomLowerSidesMesh = new THREE.Mesh( roomLowerSidesGeometry, roomLowerSides );
        scene.add( roomLowerSidesMesh );


        var roomUpperSidesGeometry = new THREE.BoxBufferGeometry( 100, 100, 100,10,10,10);
        var roomUpperSides = [ materialTransparent, materialFloor, materialFloor,materialTransparent ,materialFloor,materialTransparent];
        roomUpperSidesMesh = new THREE.Mesh( roomUpperSidesGeometry, roomUpperSides );
        scene.add( roomUpperSidesMesh );


        var edgesGeometry = new THREE.EdgesGeometry( roomLowerSidesGeometry ); // or WireframeGeometry( geometry )
        var lineBasicMaterial = new THREE.LineBasicMaterial( { color: 0x0020A0, linewidth: 500 } );
        var boxEdges = new THREE.LineSegments( edgesGeometry, lineBasicMaterial );
        scene.add( boxEdges );

        scene.add( meshLoaded );

        var lightAmbient = new THREE.AmbientLight( 0x202020,1 );
        scene.add( lightAmbient );

        lightPointLight = new THREE.PointLight( 0xccffcc, 1  );
        lightPointLight.position.set( 0, 10, 0 );
        scene.add( lightPointLight );

        pLH1 = new THREE.PointLightHelper( lightPointLight, 0.5 );

        scene.add( pLH1 );


        render();
    }

    function handleWindowResize() {
        // Az ablak átméretezése esetén a kamera vetítési paraméterek újraszámolása
        HEIGHT = window.innerHeight;
        WIDTH = window.innerWidth;
        renderer.setSize( WIDTH, HEIGHT );
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
    }

    function showRoomSides() {
        if (roomUpperSidesMesh.visible) {
            roomUpperSidesMesh.visible = false;
            return
        }
        roomUpperSidesMesh.visible = true;
    }

    function showInfosAboutMe() {
        var about = dom.getChildByName(aboutMe);
        about.visible = false;
    }

    var render = function () {
        // Újabb képkocka rajzolásának kérése.
        // Maximálisan 60 FPS-t biztosít a rendszer.
        requestAnimationFrame( render );

        // Interaktív kameramozgatás kezelése
        controls.update();

        // 3D -> 2D vetített kép kiszámítása.
        // scene 3D színtér képe a camera kamera szemszögéből.
        renderer.render(scene, camera);
    };

</script>
</body>
</html>

